<?php
/*
 Author: Andrews54757
 License: MIT (https://github.com/ThreeLetters/SuperSQL/blob/master/LICENSE)
 Source: https://github.com/ThreeLetters/SQL-Library
 Build: v1.0.2
 Built on: 10/08/2017
*/

class SQLHelper{public$s;public$connections;function __construct($a,$b=null,$c=null,$d=null,$e=array()){$this->connections=array();if(is_array($a)){if(is_array($a[0])){foreach($a as$f=>$g){$h=isset($g['host'])?$g['host']: '';$b=isset($g['db'])?$g['db']: '';$c=isset($g['user'])?$g['user']: '';$d=isset($g['password'])?$g['password']: '';$i=isset($g['options'])?$g['options']: array();$j=self::connect($h,$b,$c,$d,$i);array_push($this->connections,$j);}}else{foreach($a as$f=>$g){array_push($this->connections,$g);}}$this->s=$this->connections[0];}else if(is_string($a)){$this->s=self::connect($a,$b,$c,$d,$e);array_push($this->connections,$this->s);}else{array_push($this->connections,$a);$this->s=$a;}}static function connect($h,$b,$c,$d,$e=array()){$k='mysql';$l=false;if(is_string($e)){if(strpos($e,':')!==false){$l=$e;}else{$k=strtolower($e);}}else if(isset($e['dbtype']))$k=strtolower($e['dbtype']);if(!$l){$m='';switch($k){case 'pgsql':$m='pgsql';$n=array('dbname'=>$b,'host'=>$h);if(isset($e['port']))$n['port']=$e['port'];break;case 'sybase':$m='dblib';$n=array('dbname'=>$b,'host'=>$h);if(isset($e['port']))$n['port']=$e['port'];break;case 'oracle':$m='oci';$n=array('dbname'=>isset($h)? '//'.$h.':'.(isset($e['port'])?$e['port']: '1521').'/'.$b :$b);break;default:$m='mysql';$n=array('dbname'=>$b);if(isset($e['socket']))$n['unix_socket']=$e['socket'];else{$n['host']=$h;if(isset($e['port']))$n['port']=$e['port'];}break;}$l=$m.':';if(isset($e['charset'])){$n['charset']=$e['charset'];}$l=$m.':';$o=0;foreach($n as$f=>$p){if($o!=0){$l.=';';}$l.=$f.'='.$p;$o++;}}return new SuperSQL($l,$c,$d);}private static function rmComments($q){$r=strpos($q,'#');if($r!==false){$q=substr($q,0,$r);}return trim($q);}private static function escape($s){$t=strtolower(gettype($s));if($t=='boolean'){$s=$s ? '1' : '0';}else if($t=='string'){$s='\''.$s.'\'';}else if($t=='double'||$t=='integer'){$s=(int)$s;}else if($t=='null'){$s='0';}return$s;}private static function escape2($s){if(is_numeric($s)){return(int)$s;}else{return '\''.$s.'\'';}}private static function includes($p,$u){foreach($u as$g){if(strpos($p,$g)!==false)return true;}return false;}private static function containsAdv($u){foreach($u as$f=>$p){if(is_array($p))return true;if(self::includes($f,array('[','#'))||self::includes($p,array('[')))return true;if(self::includes($p,array('DISTINCT','INSERT INTO','INTO')))return true;}return false;}function change($v){$this->s=$this->connections[$v];return$this->s;}function getCon($w=false){if($w){return$this->connections;}else{return$this->s;}}function get($x,$y,$z,$aa=null){$ba=$this->s->SELECT($x,$y,$z,$aa,1)->getData();return($ba&&$ba[0])?$ba[0]: false;}function create($x,$n){$ca='CREATE TABLE `'.$x.'` (';$r=0;foreach($n as$f=>$p){if($r!=0){$ca.=', ';}$ca.='`'.$f.'` '.$p;$r++;}$ca.=')';return$this->s->query($ca);}function drop($x){return$this->s->query('DROP TABLE `'.$x.'`');}function replace($x,$n,$z=array()){$da=array();foreach($n as$f=>$p){$q='`'.self::rmComments($f).'`';foreach($p as$ea=>$g){$q='REPLACE('.$q.', '.self::escape2($ea).', '.self::escape($g).')';}$da['#'.$f]=$q;}return$this->s->UPDATE($x,$da,$z);}function select($x,$y=array(),$z=array(),$aa=null,$fa=false){if(is_array($x)||self::containsAdv($y)||self::containsAdv($z)||$aa){return$this->s->SELECT($x,$y,$z,$aa,$fa);}else{if(is_int($fa))$fa='LIMIT '.(int)$fa;return$this->s->sSELECT($x,$y,$z,$fa);}}function insert($x,$n){if(is_array($x)||self::containsAdv($n)){return$this->s->INSERT($x,$n);}else{return$this->s->sINSERT($x,$n);}}function update($x,$n,$z=array()){if(is_array($x)||self::containsAdv($n)||self::containsAdv($z)){return$this->s->UPDATE($x,$n,$z);}else{return$this->s->sUPDATE($x,$n,$z);}}function delete($x,$z=array()){if(is_array($x)||self::containsAdv($z)){return$this->s->DELETE($x,$z);}else{return$this->s->sDELETE($x,$z);}}function sqBase($ca,$z,$aa){$ga=array();if($aa){AdvParser::JOIN($aa,$ca);}if(count($z)!=0){$ca.=' WHERE ';$ca.=AdvParser::conditions($z,$ga);}$ha=$this->_query($ca,$ga)[0];return$ha->fetchColumn();}function count($x,$z=array(),$aa=array()){return$this->sqBase('SELECT COUNT(*) FROM `'.$x.'`',$z,$aa);}function avg(){return$this->sqBase('SELECT AVG(`'.$column.'`) FROM `'.$x.'`',$z,$aa);}function max($x,$ia,$z=array(),$aa=array()){return$this->sqBase('SELECT MAX(`'.$ia.'`) FROM `'.$x.'`',$z,$aa);}function min($x,$ia,$z=array(),$aa=array()){return$this->sqBase('SELECT MIN(`'.$ia.'`) FROM `'.$x.'`',$z,$aa);}function sum($x,$ia,$z=array(),$aa=array()){return$this->sqBase('SELECT SUM(`'.$ia.'`) FROM `'.$x.'`',$z,$aa);}function _query($ca,$ja){$ka=$this->s->con->db->prepare($ca);foreach($ja as$f=>&$la){$ka->bindParam($f+1,$la[0],$la[1]);}$ma=$ka->execute();return array($ka,$ma);}function query($na,$o=null){return$this->s->con->query($na,$o);}function transact($oa){return$this->s->transact($oa);}}
?>